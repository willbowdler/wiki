CREATE TABLE "comments" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"user_id" INTEGER NOT NULL,
	"article_id" INTEGER NOT NULL,
	"content" TEXT NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL,
	"updated_at" TIMESTAMPTZ,
	PRIMARY KEY("id")
);




CREATE TABLE "articles" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"title" VARCHAR(255) NOT NULL,
	"content" TEXT NOT NULL,
	"subtitle" VARCHAR(255),
	"user_id" INTEGER NOT NULL,
	"topic_id" INTEGER NOT NULL,
	"slug" VARCHAR(255) NOT NULL UNIQUE,
	"comments_disabled" BOOLEAN NOT NULL DEFAULT FALSE,
	"status" VARCHAR(255),
	"published_at" TIMESTAMPTZ,
	"created_at" TIMESTAMPTZ NOT NULL,
	"updated_at" TIMESTAMPTZ,
	PRIMARY KEY("id")
);




CREATE TABLE "users" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"first_name" VARCHAR(255) NOT NULL,
	"last_name" VARCHAR(255),
	"username" VARCHAR(255) NOT NULL UNIQUE,
	"email" VARCHAR(255) NOT NULL UNIQUE,
	"role" VARCHAR(255) NOT NULL,
	"password_hash" VARCHAR(255) NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL,
	"updated_at" TIMESTAMPTZ,
	PRIMARY KEY("id")
);




CREATE TABLE "topics" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"name" VARCHAR(255) NOT NULL,
	"description" TEXT NOT NULL,
	"slug" VARCHAR(255) NOT NULL UNIQUE,
	"created_at" TIMESTAMPTZ NOT NULL,
	"updated_at" TIMESTAMPTZ,
	PRIMARY KEY("id")
);




CREATE TABLE "articles_tags" (
	"article_id" INTEGER NOT NULL,
	"tag_id" INTEGER NOT NULL,
	PRIMARY KEY("article_id", "tag_id")
);




CREATE TABLE "tags" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"name" VARCHAR(255) NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL,
	"updated_at" TIMESTAMPTZ,
	PRIMARY KEY("id")
);



ALTER TABLE "articles"
ADD FOREIGN KEY("user_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "articles_tags"
ADD FOREIGN KEY("article_id") REFERENCES "articles"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "articles"
ADD FOREIGN KEY("topic_id") REFERENCES "topics"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "comments"
ADD FOREIGN KEY("user_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "articles_tags"
ADD FOREIGN KEY("tag_id") REFERENCES "tags"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "comments"
ADD FOREIGN KEY("article_id") REFERENCES "articles"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;